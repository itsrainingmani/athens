{"version":3,"sources":["athens/components.cljs"],"mappings":";;;;;AASA,AAAA,AAAMA,AACHC,AAAIC,AAASC;AADhB,AAEE,AAAMC,AAAsB,AAAA,AAAe,AAAA,AAAA,AAACC,AAAyBJ;AAArE,AACE,AAAAK,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAqCL,AACA,AAACO,AACCJ,AACAF,AACAC,AACF,AAACM;AALtC,AAAA,AAAAH,AAAAA,AAACC,AAAAA,AAAAA;;AAQL,AAAA,AAAMG,AACHC;AADH,AAEE,AAAA,AAACC,AAAkBD;;AAIrB,AAAA,AAAA,AAAA,AAAA,AAAKE,AAEM,AAAKC,AAAEb;AAAP,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA;AAAA,AAEsB,AAAA,AAAA,AAACD,AAAcC;;;AAGhD,AAAA,AAAA,AAAA,AAAA,AAAKc,AAEM,AAAKD,AAAEb;AAAP,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA;AAAA,AAGsB,AAAA,AAAA,AAACD,AAAcC;;;AAIhD,AAAA,AAAA,AAAA,AAAA,AAAKe,AAEM,AAAKL,AAAQG;AAAb,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAE0B,AAAA,AAAsC,AAAA,AAACG,AAAI,AAAA,AAACL,AAAiCD;;AAIlH,AAAA,AAAA,AAAA,AAAA,AAAKO,AAEM,AAAKP,AAAQG;AAAb,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAE0B,AAACJ,AAAaC;;AAInD,AAAA,AAAKQ,AAAYN,AAAeE,AAAeC,AAAwBE;AAIvE,AAAA,AAAME,AACHT,AAAQG;AADX,AAAA,AAAA,AAEWH;;AAIX;;;AAAA,AAAMU,AAEHV,AAAQV;AAFX,AAGE,AAAMqB,AAAW,AAACC,AAAK,AAAKC;AAAL,AACE,AAAM,AAACC,AAAW,AAAA,AAAQD,AAAMb;AAAhC,AACE,AAAA,AAASa;;AADX;;AACmBL;AAF5C,AAAA,AAAA,AAAA,AAAA,AAGoB,AAAKO;AAAL,AACE,AAAIA;AACvB,AAAA,AAAA,AAAIJ,AACDA,AAAkBX,AAAQV,AAC1BmB,AAAkBT,AAAQV","names":["athens.components/todo-on-click","uid","from-str","to-str","current-block-content","athens.db/get-block","G__56212","re-frame.core/dispatch","clojure.string/replace","athens.util/now-ts","athens.components/find-weblink","content","cljs.core/re-find","athens.components/component-todo","_","athens.components/component-done","athens.components/component-youtube-embed","cljs.core.get.cljs$core$IFn$_invoke$arity$2","athens.components/component-generic-embed","athens.components/components","athens.components/empty-component","athens.components/render-component","render","cljs.core/some","comp","cljs.core/re-matches","e"],"sourcesContent":["(ns athens.components\n  (:require\n    [athens.db :as db]\n    [athens.util :refer [now-ts]]\n    [re-frame.core :refer [dispatch]]))\n\n;; Note to contributors: After you define the component, you should add it in the exported components vector at bottom.\n\n;; ---- Helper functions for default components ----\n(defn todo-on-click\n  [uid from-str to-str]\n  (let [current-block-content (:block/string (db/get-block [:block/uid uid]))]\n    (dispatch [:transact [{:block/uid    uid\n                           :block/string (clojure.string/replace\n                                           current-block-content\n                                           from-str\n                                           to-str)\n                           :edit/time    (now-ts)}]])))\n\n\n(defn find-weblink\n  [content]\n  (re-find #\"http.*\" content))\n\n\n;; ---- Todo component declaration ----\n(def component-todo\n  {:match #\"\\[\\[TODO\\]\\]\"\n   :render (fn [_ uid]\n             [:input {:type     \"checkbox\"\n                      :on-click #(todo-on-click uid #\"\\{\\{\\[\\[TODO\\]\\]\\}\\}\" \"{{[[DONE]]}}\")}])})\n\n\n(def component-done\n  {:match #\"\\[\\[DONE\\]\\]\"\n   :render (fn [_ uid]\n             [:input {:type     \"checkbox\"\n                      :checked  \"true\"\n                      :on-click #(todo-on-click uid #\"\\{\\{\\[\\[DONE\\]\\]\\}\\}\" \"{{[[TODO]]}}\")}])})\n\n\n;; ---- Website embed component declaration ----\n(def component-youtube-embed\n  {:match  #\"\\[\\[youtube\\]\\]\\:.*\"\n   :render (fn [content _]\n             [:div.media-16-9\n              [:iframe {:src         (str \"https://www.youtube.com/embed/\" (get (re-find #\".*v=([a-zA-Z0-9_\\-]+)\" content) 1))\n                        :allow       \"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\"}]])})\n\n\n(def component-generic-embed\n  {:match  #\"iframe\\:.*\"\n   :render (fn [content _]\n             [:div.media-16-9\n              [:iframe {:src         (find-weblink content)}]])})\n\n\n;; Components\n(def components [component-todo component-done component-youtube-embed component-generic-embed])\n\n\n;; ---- Render function for custom components\n(defn empty-component\n  [content _]\n  [:button content])\n\n\n;; TODO: use metaprogramming to achieve dynamic rendering with both basic components and custom components\n(defn render-component\n  \"Renders a component using its parse tree & its uid.\"\n  [content uid]\n  (let [render     (some (fn [comp]\n                           (when (re-matches (:match comp) content)\n                             (:render comp))) components)]\n    [:span {:on-click (fn [e]\n                        (.. e stopPropagation))}\n     (if render\n       [render            content uid]\n       [empty-component   content uid])]))\n"]}